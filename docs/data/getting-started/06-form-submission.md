# Form submission

Now that we have a server, we can handle form submission with `handlers`

## Handlers

You can export in a [page descriptor](/docs/concepts/page-descriptor) (both dynamic and static) an extra object `handlers` :

```ts
import type * as frugal from 'https://deno.land/x/frugal/packages/core/mod.ts';

//...

export const handler: frugal.Handlers<Path, Data> = {
    POST: (request, context) => {
        // do something to build data object
        return { data };
    },
};
```

Methods in the `handlers` object will be called in response to a `POST`, `PATCH`, `PUT` or `DELETE` request. The data object will then be fed to the `getContent` function to generate the page that will be served to the client. Think of the `handlers` methods as a `getDynamicData` function for non-`GET` requests.

## POST-Redirect-GET (PRG) pattern

When a client submit a form (via `POST`, `PATCH`, `PUT` or `DELETE`), we want to avoid the situation where the form is submited again if the client refreshes the page. To do so, frugal uses the [PRG pattern](https://en.wikipedia.org/wiki/Post/Redirect/Get). The page generated by the `handlers` will not be immediatly served to the client. Instead, when a `POST`/`PATCH`/`PUT`/`DELETE` request comes, the content is generated and stored in session, and the client recieve a 303 response with a session cookie that will redirect it to a `GET` request on the same url. On the `GET` request, frugal will detect the session cookie and serve the content stored in the session.

The user get the result of the `POST`/`PATCH`/`PUT`/`DELETE` request on a `GET` request. Refreshing the page will not resubmit the form.

For this pattern to work, frugal needs to persist some data between two requests. On a standard server this can be done using filesystem but in serverless context there is not runtime filesystem to write pages in. To fix that, frugal abstract read and write with a [persistance layer](/docs/concepts/persistance-layer). By default frugal uses a filesystem persistance layer, but you can configure frugal to use a different one :

```ts
export const config: frugal.Config = {
    //...
    server: {
        sessionPersistance: myPersistanceLayer,
    },
};
```
